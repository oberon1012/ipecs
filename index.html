<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, shrink-to-fit=no">
    <title>iPecs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: Arial, sans-serif;
            background-color: #E7E7E7;
            height: 100%;
            overflow: hidden;
            -webkit-text-size-adjust: none;
            -webkit-overflow-scrolling: touch;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        * {
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* Désactive bounce et pull-to-refresh sur iPhone */
        body {
            position: fixed;
            width: 100%;
            height: 100%;
            overscroll-behavior: none;
        }

        /* MENU-1 */
        .menu-1 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(#FFB84D, #B26B00);
            z-index: 1000;
            display: flex;
        }

        .menu-1 .half {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .function-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            position: relative;
        }

        .function-btn.selected {
            background: radial-gradient(circle, #00FF41, #39FF14);
            box-shadow: 0 0 30px #00FF41, 0 0 60px #39FF14, 0 0 20px rgba(0, 255, 65, 0.9);
        }

        .function-btn.unselected {
            background: #2E4B35;
        }

        /* MENU-2 */
        .menu-2 {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(#B2B2B2, #4D4D4D);
            z-index: 999;
            display: flex;
        }

        .menu-2 .third {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .menu-2 img {
            width: 50px;
            height: auto;
            cursor: pointer;
        }

        /* Zone principale */
        .main-content {
            position: fixed;
            top: 120px;
            left: 0;
            width: 100%;
            height: calc(100vh - 120px);
            background-color: #E7E7E7;
        }

        /* DIV-1 */
        .div-1 {
            width: 100%;
            height: 100%;
            background-color: #E7E7E7;
            border-bottom: 1px solid red;
            overflow: hidden;
            padding: 0;
        }

        .div-1 table {
            width: 100%;
            height: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .div-1 td {
            width: 50%;
            height: 33.33%;
            vertical-align: middle;
            text-align: center;
            background: transparent;
            border: none;
            padding: 0;
            position: relative;
        }

        .div-1 .text-zone {
            display: inline-block;
            margin: 0 auto;
        }

        .text-zone {
            background-color: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s ease;
            text-align: center;
            word-wrap: break-word;
            line-height: 1.2;
            box-sizing: border-box;
        }

        .text-zone.speaking {
            transform: scale(1.1);
            color: #FFD700;
        }

        /* DIV-2 */
        .div-2 {
            width: 100%;
            height: 100%;
            background-color: #E7E7E7;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            display: none;
        }

        .directory {
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .directory-name {
            font-size: 150%;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .triangle {
            width: 0;
            height: 0;
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .triangle.closed {
            border-left: 8px solid black;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .triangle.open {
            border-top: 8px solid black;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            transform: rotate(0deg);
        }

        .directory-content {
            display: none;
            margin-left: 0px;
        }

        .directory-content.open {
            display: block;
        }

        .subdirectory {
            margin-bottom: 15px;
        }

        .subdirectory-name {
            font-size: 150%;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .file-item {
            display: flex;
            align-items: center;
            margin-top: 8px;
            font-size: 130%;
            cursor: pointer;
        }

        .file-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #ccc;
            margin-right: 10px;
            position: relative;
            cursor: pointer;
        }

        .file-checkbox.checked {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }

        .file-checkbox.checked::after {
            content: '✓';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
        }

        .file-name {
            text-transform: capitalize;
        }

        /* DIV-3 */
        .div-3 {
            width: 100%;
            height: 100%;
            background-color: #E7E7E7;
            overflow: hidden;
            display: none;
            position: relative;
        }

        .div-3.grid-mode {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 0;
            padding: 0;
        }

        .image-content-zone {
            background: transparent;
            border: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .image-zone {
            background: transparent;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 150px;
            height: 150px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 10px;
        }

        .image-zone.clicked {
            transform: scale(1.1);
            border-color: yellow;
            transition: all 0.4s ease;
        }

        .image-text-zone {
            background: transparent;
            border: none;
            text-align: center;
            margin-top: 10px;
            vertical-align: top;
        }

        .image-container {
            position: absolute;
            text-align: center;
            cursor: pointer;
        }

        .image-container img {
            border-radius: 10px;
            width: 180px;
            height: 180px;
            object-fit: cover;
        }

        .image-label {
            margin-top: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Modal de saisie */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        .modal-input {
            width: 300px;
            height: 50px;
            font-size: 18px;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .modal-buttons img {
            width: 50px;
            height: auto;
            cursor: pointer;
        }

        /* Styles responsifs */
        @media screen and (max-width: 480px) {
            .text-zone {
                font-size: 20px;
            }
            .image-zone {
                width: 120px !important;
                height: 120px !important;
            }
        }

        @media screen and (min-width: 481px) {
            .text-zone {
                font-size: 36px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- MENU-1 -->
    <div class="menu-1">
        <div class="half">
            <button id="btn-fct1" class="function-btn selected"></button>
        </div>
        <div class="half">
            <button id="btn-fct2" class="function-btn unselected"></button>
        </div>
    </div>

    <!-- MENU-2 -->
    <div class="menu-2">
        <div class="third" id="menu2-left"></div>
        <div class="third" id="menu2-center">
            <img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">
        </div>
        <div class="third" id="menu2-right">
            <img src="img/icone_plus.png" alt="Plus" id="btn-plus">
        </div>
    </div>

    <!-- Zone principale -->
    <div class="main-content">
        <!-- DIV-1 -->
        <div id="div-1" class="div-1"></div>

        <!-- DIV-2 -->
        <div id="div-2" class="div-2"></div>

        <!-- DIV-3 -->
        <div id="div-3" class="div-3"></div>
    </div>

    <!-- Modal de saisie -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <input type="text" id="text-input" class="modal-input" maxlength="30" autocomplete="off">
            <div class="modal-buttons">
                <img src="img/icone_fleche_gauche.png" alt="Annuler" id="btn-cancel">
                <img src="img/icone_ok.png" alt="OK" id="btn-ok">
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentFunction = 1;
        let textZones = [];
        let selectedFiles = [];
        let pictosData = {};
        let maxTextZones = 6;
        let maxImages = 6;

        // Désactiver le zoom par double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Désactiver le zoom par gestes
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });

        document.addEventListener('gesturechange', function (e) {
            e.preventDefault();
        });

        document.addEventListener('gestureend', function (e) {
            e.preventDefault();
        });

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadPictosData();
            setupEventListeners();
            updateDisplay();
            calculateZoneSizes();
        });

        // Gestion du redimensionnement
        window.addEventListener('resize', function() {
            calculateZoneSizes();
            updateTextZonesDisplay();
            updateImagesDisplay();
        });

        // Chargement des données pictos
        async function loadPictosData() {
            try {
                const response = await fetch('pictos.json');
                pictosData = await response.json();
                generateDirectoryTree();
            } catch (error) {
                console.error('Erreur lors du chargement de pictos.json:', error);
            }
        }

        // Configuration des event listeners
        function setupEventListeners() {
            // Boutons de fonction
            document.getElementById('btn-fct1').addEventListener('click', () => selectFunction(1));
            document.getElementById('btn-fct2').addEventListener('click', () => selectFunction(2));

            // Boutons du menu-2
            document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
            document.getElementById('btn-plus').addEventListener('click', showTextInput);

            // Modal
            document.getElementById('btn-cancel').addEventListener('click', hideTextInput);
            document.getElementById('btn-ok').addEventListener('click', addTextZone);
            document.getElementById('text-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTextZone();
                }
            });
        }

        // Sélection de fonction
        function selectFunction(funcNum) {
            currentFunction = funcNum;
            
            const btn1 = document.getElementById('btn-fct1');
            const btn2 = document.getElementById('btn-fct2');
            
            if (funcNum === 1) {
                btn1.className = 'function-btn selected';
                btn2.className = 'function-btn unselected';
            } else {
                btn1.className = 'function-btn unselected';
                btn2.className = 'function-btn selected';
            }
            
            updateDisplay();
        }

        // Mise à jour de l'affichage
        function updateDisplay() {
            const div1 = document.getElementById('div-1');
            const div2 = document.getElementById('div-2');
            const div3 = document.getElementById('div-3');
            const menu2Left = document.getElementById('menu2-left');
            const menu2Center = document.getElementById('menu2-center');
            const menu2Right = document.getElementById('menu2-right');

            // Masquer toutes les divs
            div1.style.display = 'none';
            div2.style.display = 'none';
            div3.style.display = 'none';

            if (currentFunction === 1) {
                // Fonction 1 : afficher DIV-1
                div1.style.display = 'block';
                
                // Menu-2 pour fonction 1
                menu2Left.innerHTML = '';
                menu2Center.innerHTML = '<img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">';
                menu2Right.innerHTML = '<img src="img/icone_plus.png" alt="Plus" id="btn-plus">';
                
                // Réattacher les event listeners
                document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
                document.getElementById('btn-plus').addEventListener('click', showTextInput);
                
            } else {
                // Fonction 2 : afficher DIV-3 si images, sinon DIV-2
                if (selectedFiles.length > 0) {
                    div3.style.display = 'grid';
                    div3.className = 'div-3 grid-mode';
                    
                    // Menu-2 pour DIV-3
                    menu2Left.innerHTML = '<img src="img/icone_fleche_gauche.png" alt="Retour" id="btn-retour">';
                    menu2Center.innerHTML = '<img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">';
                    menu2Right.innerHTML = '';
                    
                    document.getElementById('btn-retour').addEventListener('click', showDiv2);
                    document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
                    
                    updateImagesDisplay();
                    
                } else {
                    div2.style.display = 'block';
                    
                    // Menu-2 pour DIV-2
                    menu2Left.innerHTML = '';
                    menu2Center.innerHTML = '<img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">';
                    
                    const okBtn = selectedFiles.length > 0 ? 
                        '<img src="img/icone_ok.png" alt="OK" id="btn-ok-div2">' : '';
                    menu2Right.innerHTML = okBtn;
                    
                    document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
                    if (selectedFiles.length > 0) {
                        document.getElementById('btn-ok-div2').addEventListener('click', showDiv3);
                    }
                }
            }
        }

        // Calcul des tailles des zones de contenu
        function calculateZoneSizes() {
            const div1 = document.getElementById('div-1');
            const containerWidth = div1.clientWidth / 2; // 2 colonnes
            const containerHeight = div1.clientHeight / 3; // 3 lignes
            
            const isIPhone = window.innerWidth <= 480;
            
            if (isIPhone) {
                // Pour iPhone : dimension de la case - 30px
                window.textWidth = Math.max(containerWidth - 30, 50);
                window.textHeight = Math.max(containerHeight - 30, 30);
            } else {
                // Pour autres écrans : dimension zone contenu - 100px
                window.textWidth = Math.max(containerWidth - 100, 50);
                window.textHeight = Math.max(containerHeight - 100, 30);
            }
            
            console.log('Zone sizes - Width:', window.textWidth, 'Height:', window.textHeight);
            console.log('Container sizes - Width:', containerWidth, 'Height:', containerHeight);
        }

        // Affichage du modal de saisie
        function showTextInput() {
            if (textZones.length >= maxTextZones) {
                return;
            }
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('text-input').focus();
        }

        // Masquer le modal de saisie
        function hideTextInput() {
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('text-input').value = '';
        }

        // Ajouter une zone de texte
        function addTextZone() {
            const input = document.getElementById('text-input');
            const text = input.value.trim();
            
            if (text === '' || textZones.length >= maxTextZones) {
                return;
            }
            
            textZones.push(text.toUpperCase());
            hideTextInput();
            updateTextZonesDisplay();
        }

        // Mise à jour de l'affichage des zones de texte
        function updateTextZonesDisplay() {
            const div1 = document.getElementById('div-1');
            
            // Créer le tableau 2x3
            const table = document.createElement('table');
            
            // Créer les 3 lignes
            for (let row = 0; row < 3; row++) {
                const tr = document.createElement('tr');
                
                // Créer les 2 colonnes pour chaque ligne
                for (let col = 0; col < 2; col++) {
                    const td = document.createElement('td');
                    
                    // Calculer l'index de la zone (gauche à droite, haut en bas)
                    const index = row * 2 + col;
                    
                    // Si on a une zone de texte pour cet index
                    if (index < textZones.length) {
                        const textZone = document.createElement('div');
                        textZone.className = 'text-zone';
                        textZone.innerHTML = textZones[index];
                        textZone.style.width = window.textWidth + 'px';
                        textZone.style.height = window.textHeight + 'px';
                        textZone.style.minHeight = window.textHeight + 'px';
                        textZone.style.maxHeight = window.textHeight + 'px';
                        textZone.style.display = 'flex';
                        textZone.style.alignItems = 'center';
                        textZone.style.justifyContent = 'center';
                        
                        // Event listener pour le text-to-speech
                        textZone.addEventListener('click', () => speakText(textZones[index], textZone));
                        
                        td.appendChild(textZone);
                    }
                    
                    tr.appendChild(td);
                }
                
                table.appendChild(tr);
            }
            
            div1.innerHTML = '';
            div1.appendChild(table);
        }

        // Text-to-speech
        function speakText(text, element) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                
                // Animation visuelle
                element.classList.add('speaking');
                setTimeout(() => {
                    element.classList.remove('speaking');
                }, 400);
                
                speechSynthesis.speak(utterance);
            }
        }

        // Gestion du bouton poubelle
        function handlePoubelle() {
            if (currentFunction === 1) {
                // Effacer les zones de texte
                textZones = [];
                updateTextZonesDisplay();
            } else {
                // Effacer les images et désélectionner les fichiers
                selectedFiles = [];
                updateFileSelections();
                closeAllDirectories();
                updateImagesDisplay();
                showDiv2();
            }
        }

        // Génération de l'arborescence des répertoires
        function generateDirectoryTree() {
            const div2 = document.getElementById('div-2');
            div2.innerHTML = '';
            
            Object.keys(pictosData).forEach(dirName => {
                const dirData = pictosData[dirName];
                const dirElement = createDirectoryElement(dirName, dirData, 0, '');
                div2.appendChild(dirElement);
            });
        }

        // Création d'un élément répertoire
        function createDirectoryElement(name, data, level, parentPath) {
            const dirDiv = document.createElement('div');
            dirDiv.className = 'directory';
            dirDiv.style.marginLeft = (level > 0 ? 30 : 0) + 'px';
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'directory-name';
            
            const triangle = document.createElement('div');
            triangle.className = 'triangle closed';
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = name.toUpperCase();
            
            nameDiv.appendChild(triangle);
            nameDiv.appendChild(nameSpan);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'directory-content';
            
            // Construire le chemin actuel
            const currentPath = parentPath ? `${parentPath}/${name}` : name;
            
            // Ajouter les sous-répertoires
            if (data.subdirectories) {
                Object.keys(data.subdirectories).forEach(subDirName => {
                    const subDirElement = createDirectoryElement(subDirName, data.subdirectories[subDirName], level + 1, currentPath);
                    contentDiv.appendChild(subDirElement);
                });
            }
            
            // Ajouter les fichiers
            if (data.files) {
                data.files.forEach(fileName => {
                    const fileElement = createFileElement(fileName, currentPath, level + 1);
                    contentDiv.appendChild(fileElement);
                });
            }
            
            // Event listener pour ouvrir/fermer
            nameDiv.addEventListener('click', () => {
                const isOpen = contentDiv.classList.contains('open');
                if (isOpen) {
                    contentDiv.classList.remove('open');
                    triangle.className = 'triangle closed';
                } else {
                    contentDiv.classList.add('open');
                    triangle.className = 'triangle open';
                }
            });
            
            dirDiv.appendChild(nameDiv);
            dirDiv.appendChild(contentDiv);
            
            return dirDiv;
        }

        // Création d'un élément fichier
        function createFileElement(fileName, fullDirPath, level) {
            const fileDiv = document.createElement('div');
            fileDiv.className = 'file-item';
            fileDiv.style.marginLeft = (level > 0 ? 30 : 0) + 'px';
            
            const checkbox = document.createElement('div');
            checkbox.className = 'file-checkbox';
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'file-name';
            nameSpan.textContent = fileName.replace('.jpg', '');
            nameSpan.style.textTransform = 'capitalize';
            
            const filePath = `pictos/${fullDirPath}/${fileName}`;
            
            // Event listener pour la sélection
            fileDiv.addEventListener('click', () => {
                if (selectedFiles.length >= maxImages && !selectedFiles.includes(filePath)) {
                    return;
                }
                
                const index = selectedFiles.indexOf(filePath);
                if (index > -1) {
                    selectedFiles.splice(index, 1);
                    checkbox.classList.remove('checked');
                } else {
                    selectedFiles.push(filePath);
                    checkbox.classList.add('checked');
                }
                
                updateImagesDisplay();
                updateMenu2ForDiv2();
            });
            
            fileDiv.appendChild(checkbox);
            fileDiv.appendChild(nameSpan);
            
            return fileDiv;
        }

        // Mise à jour des sélections de fichiers
        function updateFileSelections() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.classList.remove('checked');
            });
        }

        // Fermer tous les répertoires
        function closeAllDirectories() {
            const directoryContents = document.querySelectorAll('.directory-content');
            const triangles = document.querySelectorAll('.triangle');
            
            directoryContents.forEach(content => {
                content.classList.remove('open');
            });
            
            triangles.forEach(triangle => {
                triangle.className = 'triangle closed';
            });
        }

        // Mise à jour du menu-2 pour DIV-2
        function updateMenu2ForDiv2() {
            if (currentFunction === 2 && document.getElementById('div-2').style.display === 'block') {
                const menu2Right = document.getElementById('menu2-right');
                const okBtn = selectedFiles.length > 0 ? 
                    '<img src="img/icone_ok.png" alt="OK" id="btn-ok-div2">' : '';
                menu2Right.innerHTML = okBtn;
                
                if (selectedFiles.length > 0) {
                    document.getElementById('btn-ok-div2').addEventListener('click', showDiv3);
                }
            }
        }

        // Afficher DIV-2
        function showDiv2() {
            document.getElementById('div-3').style.display = 'none';
            document.getElementById('div-2').style.display = 'block';
            
            const menu2Left = document.getElementById('menu2-left');
            const menu2Center = document.getElementById('menu2-center');
            const menu2Right = document.getElementById('menu2-right');
            
            menu2Left.innerHTML = '';
            menu2Center.innerHTML = '<img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">';
            
            const okBtn = selectedFiles.length > 0 ? 
                '<img src="img/icone_ok.png" alt="OK" id="btn-ok-div2">' : '';
            menu2Right.innerHTML = okBtn;
            
            document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
            if (selectedFiles.length > 0) {
                document.getElementById('btn-ok-div2').addEventListener('click', showDiv3);
            }
        }

        // Afficher DIV-3
        function showDiv3() {
            document.getElementById('div-2').style.display = 'none';
            const div3 = document.getElementById('div-3');
            div3.style.display = 'grid';
            
            const menu2Left = document.getElementById('menu2-left');
            const menu2Center = document.getElementById('menu2-center');
            const menu2Right = document.getElementById('menu2-right');
            
            menu2Left.innerHTML = '<img src="img/icone_fleche_gauche.png" alt="Retour" id="btn-retour">';
            menu2Center.innerHTML = '<img src="img/icone_poubelle.png" alt="Poubelle" id="btn-poubelle">';
            menu2Right.innerHTML = '';
            
            document.getElementById('btn-retour').addEventListener('click', showDiv2);
            document.getElementById('btn-poubelle').addEventListener('click', handlePoubelle);
            
            updateImagesDisplay();
        }

        // Mise à jour de l'affichage des images
        function updateImagesDisplay() {
            const div3 = document.getElementById('div-3');
            div3.innerHTML = '';
            div3.className = 'div-3 grid-mode';
            
            // Créer les 6 zones de contenu de la grille
            for (let i = 0; i < 6; i++) {
                const contentZone = document.createElement('div');
                contentZone.className = 'image-content-zone';
                
                // Si on a une image pour cet index
                if (i < selectedFiles.length) {
                    const filePath = selectedFiles[i];
                    const fileName = filePath.split('/').pop().replace('.jpg', '');
                    
                    // Zone d'image avec background-image
                    const imageZone = document.createElement('div');
                    imageZone.className = 'image-zone';
                    imageZone.style.backgroundImage = `url("${filePath}")`;
                    
                    // Zone de texte
                    const textZone = document.createElement('div');
                    textZone.className = 'image-text-zone image-label';
                    textZone.textContent = fileName.replace(/_/g, ' ').toUpperCase();
                    
                    contentZone.appendChild(imageZone);
                    contentZone.appendChild(textZone);
                    
                    // Event listener pour le text-to-speech et l'effet visuel
                    contentZone.addEventListener('click', () => {
                        // Ajouter l'effet de clic
                        imageZone.classList.add('clicked');
                        
                        // Supprimer l'effet après 400ms
                        setTimeout(() => {
                            imageZone.classList.remove('clicked');
                        }, 400);
                        
                        speakText(fileName, contentZone);
                    });
                }
                
                div3.appendChild(contentZone);
            }
        }
    </script>
</body>
</html>